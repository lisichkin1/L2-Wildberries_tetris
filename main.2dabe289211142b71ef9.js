(()=>{"use strict";const e=["S","Z","T","O","I","J","L"],o={S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],T:[[0,1,0],[1,1,1],[0,0,0]],O:[[1,1],[1,1]],I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]]},t=(e,o)=>10*e+o;let r=[];const n=()=>{const t=(r=e)[Math.floor(Math.random()*r.length)];var r;const n=o[t];return{name:t,form:n,column:5-Math.floor(n.length/2),row:-2}},l=(e,o)=>{const{form:t}=e,r=t.length;for(let n=0;n<r;n++)for(let l=0;l<r;l++)if(0!=t[n][l]){if(s(e,n,l,o))return!0;if(c(e,n,l,o))return!0}return!1},c=(e,o,t,r)=>{var n;return null===(n=r[e.row+o])||void 0===n?void 0:n[e.column+t]},s=(e,o,t,r)=>{const{column:n,row:l}=e;return n+t<0||n+t>=10||l+o>=r.length};function i(){let e,o=!1,c=0,s=0,i=(()=>{const e=document.querySelector(".teris__container");e.innerHTML="";for(let o=0;o<20;o++){r[o]=[];for(let t=0;t<10;t++){r[o][t]=0;const n=document.createElement("div");e.appendChild(n)}}return r})();const f=document.querySelector(".score__point"),u=document.querySelector(".lines__point"),a=document.querySelectorAll(".teris__container > div");let m=n();const d=()=>{a.forEach((e=>e.removeAttribute("class"))),(()=>{for(let e=0;e<20;e++)for(let o=0;o<10;o++){if(!i[e][o])continue;const r=i[e][o],n=t(e,o);a[n].classList.add(r)}})(),((e,o)=>{const r=e.name,n=e.form.length;for(let l=0;l<n;l++)for(let c=0;c<n;c++)1==e.form[l][c]&&(e.row+l<0||o[t(e.row+l,e.column+c)].classList.add(r))})(m,a)},h=()=>{o||(w(m,i),d(),clearTimeout(e),e=setTimeout((()=>h()),500))},y=e=>m.row+e<0,g=(e,o)=>{f.innerText=e,u.innerText=o},w=(e,o)=>(e.row+=1,l(e,o)&&(e.row-=1,k(e),console.log(o)),e),k=e=>{const{form:t,row:r,column:l}=e;for(let n=0;n<t.length;n++)for(let c=0;c<t[n].length;c++)if(1===t[n][c]){const t=r+n,s=l+c;if(y(n))return console.log("конец"),void(o=!0);i[t][s]=e.name}const f=(()=>{const e=i.filter((e=>!e.every((e=>Boolean(e))))),o=20-e.length;return i=[...Array(20-e.length).fill(new Array(10).fill(0)),...e],console.log(o),o})();(e=>{switch(e){case 1:c+=40,s+=1,g(c,s);break;case 2:c+=100,s+=2,g(c,s);break;case 3:c+=300,s+=3,g(c,s);break;case 4:c+=1200,s+=4,g(c,s)}})(f),m=n(),d()};h(),document.addEventListener("keydown",(e=>{if(!o)if("s"==e.key||"ы"==e.key)h();else if("a"==e.key||"ф"==e.key)((e,o)=>{e.column-=1,l(e,o)&&(e.column+=1)})(m,i),d(),console.log("нажатие");else if("d"==e.key||"в"==e.key)((e,o)=>{e.column+=1,l(e,o)&&(e.column-=1)})(m,i),d();else{if(" "!=e.key)return;((e,o)=>{const t=e.form,r=(e=>{const o=e.form,t=o.length,r=o[0].length,n=Array.from({length:r},(()=>Array(t).fill(0)));for(let e=0;e<t;e++)for(let l=0;l<r;l++)n[l][t-1-e]=o[e][l];return n})(e);e.form=r,l(e,o)&&(e.form=t)})(m,i),d()}}))}document.querySelector(".new_game").addEventListener("click",(()=>{i()})),i()})();